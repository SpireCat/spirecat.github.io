---
layout: post
title:  "Android源码分析学习笔记1——粗探安卓"
date:   2016-6-02 13:25
categories: Android
permalink: /archivers/android1
---

&#160; &#160; &#160; &#160;（此处略去描述Android历史、现状、优点、缺陷等特征的若干文字。）

# 1. Android系统架构
<p><img src="/img/android1-0.jpg" /></p>

&#160; &#160; &#160; &#160;根据Android操作系统的组件结构框图可知，其软件层次结构自下而上分为4层：

* 操作系统层（即Linux内核层）
* 各种库（Libraries）和Android运行环境（Runtime）
* 应用程序框架（Application Framework）
* 应用程序（Application）

## 1.1 底层操作系统层（Linux内核层）

&#160; &#160; &#160; &#160;首先需要更正的是原书作者疏忽的一个点。原书上的作者写“Android使用Linux2.6作为操作系统”并在后面的描述中没有作更多解释，然而显然这是有失偏颇的。不同版本的Android使用的Linux内核版本是不一样的，据资料显示，Android4.4版本已经采用了Linux3.8.0的内核。

&#160; &#160; &#160; &#160;Android对Linux操作系统的使用包括核心和驱动程序两部分。尤为重要的是，Android作为一个移动端的嵌入式系统，更多的是需要一些与移动设备相关的驱动程序。主要的驱动程序包括：显示驱动、Flash内存驱动、照相机驱动、音频驱动、Wi-Fi驱动、键盘驱动、蓝牙驱动、Binder IPC驱动、电源管理等。

## 1.2 库（Libraries）和Android运行环境（Runtime）

&#160; &#160; &#160; &#160;Android的本层次分成两个部分，一个是各种库，另一个是Android运行环境。本层次大多使用C语言实现，其中包含了以下几种库：C语言库、多媒体框架、2D图像引擎、SSL（位Secure Socket Layer，位于TCP/IP协议与各种应用层协议之间，为数据通信提供安全支持）、OpenGL ES（提供了对3D的支持）、界面管理工具、SQLite、Webkit、FreeType（位图和矢量字体的功能）等。

&#160; &#160; &#160; &#160;另外，Android的运行环境主要是基于Dalvik技术的。而Dalvik与一般的Java虚拟机是有如下区别的：

+ Java虚拟机：执行的是Java标准的字节码。

+Dalvik：执行的是Dalvik可执行格式（.dex）的文件。在执行的过程中，每一个应用程序即一个进程（Linux的一个Process）。

&#160; &#160; &#160; &#160;二者最大的区别在于，JVM是基于栈的虚拟机，而Dalvik是基于寄存器的虚拟机。显然，后者最大的好处在于可以依据硬件实现最大的优化，这样更适合移动设备的优点。

## 1.3 应用程序框架（Application Framework）

&#160; &#160; &#160; &#160;在整个Android系统中，与应用开发最相关的是Application Framework，在这一层，Android为应用程序层的开发者提供了功能强大的APIs，这实际上是一个应用程序的框架。由于上层的应用程序是以Java构建的。在本层提供了程序所需要的各种控件，例如：Views（视图组件）、List（列表）、Grid（栅格）、Text Box（文本框）、Button（按钮），甚至还有一个嵌入式的Web浏览器。

&#160; &#160; &#160; &#160;一个基本的Android应用程序可以利用应用程序框架中的以下5个部分：

+ Activity： 活动
+ Broadcast Intent Receiver： 广播意图接收者
+ Service： 服务
+ Content Provider： 内容提供者
+ Intent and Intent Provider: 意图和意图过滤器

## 顶层应用程序（Application）

&#160; &#160; &#160; &#160;Android的应用程序主要是用户界面（User Interface）方面的，本层通常使用Java语言编写，其中还可以包含各种被放置在“res”目录中的资源文件。Java程序和相关资源在经过编译后，会生成一个APK包。Android本身提供了主屏幕（Home）、联系人（Contact）、浏览器（Browsers）等众多的核心应用。同时应用程序的开发者还可以使用应用程序框架层的API实现自己的程序。

# 2. 核心组件

## 2.1 Activity的界面表现

&#160; &#160; &#160; &#160;Activity是这五个组件中最常用的组件，通常的表现形式是一个单独的界面。每个Activity都是一个单独的类，它扩展实现了Activity基础类。这个类显示为一个由Views组成的用户界面，并响应事件。每个界面都是一个Activity，切换到另一个界面就是载入一个新的Activity。某些情况下，一个Activity可能会给前一个Activity返回值。

&#160; &#160; &#160; &#160;打开一个新的界面后，前一个界面就被暂停，并放入界面切换历史栈中。使用者可以回溯之前的界面也可以删除之前的界面。

## 2.2 Intent和IntentFilters界面切换

&#160; &#160; &#160; &#160;Android通过一个专门的Intent类来进行界面的切换。Intent描述了程序想做什么。Intent类还有一个相关类InentFilter。Intent是一个请求，用来明确做什么事情，IntentFilter则描述了一个Activity（或下文的IntentReceiver）能处理什么意图。Activities在文件AndroidManifest.xml中使用IntentFilters。

&#160; &#160; &#160; &#160;通过解析Intents可以实现Activity的切换，我们可以使用startActivity（myIntent）启用新的Activity。系统会考察所有安装程序的IntentFilters，然后找到与myIntent匹配最好的IntentFilters所对应的Activity。这个新Activity能够接收Intent传来的消息，并因此被启用。

## 2.3 Service服务

&#160; &#160; &#160; &#160;